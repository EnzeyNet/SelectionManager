!function(a){"use strict";var b="nzSelect",c="nzDeselect",d=a.module("net.enzey.selection-manager",[]);d.provider("nzSelectionManagerConfig",function(){var a=null;this.setSelectionClass=function(b){a=b},this.$get=function(){return{getSelectionClass:function(){return a}}}}),d.directive("nzSelectionClass",["nzSelectionManagerConfig",function(a){return{controller:["$scope",function(){return{}}],require:["nzSelectionClass","^nzSelectionManager"],compile:function(d,e){var f=this.name;return{pre:function(a,b,c,d){d[0],d[1]},post:function(d,g,h,i){var j=i[0],k=i[1],l=e[f];l||(l=a.getSelectionClass());var m=j.selectionObj,n=function(){k.isSelected(m)?g.addClass(l):g.removeClass(l)};n(),d.$on(b,function(a,b){b===m&&g.addClass(l)}),d.$on(c,function(a,b){b===m&&g.removeClass(l)})}}}}}]),d.directive("nzSelectable",["$parse",function(a){return{require:["?^nzSelectionClass","^nzSelectionManager","?^ngRepeat"],compile:function(b,c){var d=this.name,e=a(c[d]);return{pre:function(a,b,c,d){var f=d[0],g=d[1],h=e(a);f&&(f.selectionObj=h),g.addSelectable(b,h),b.on("click",function(c){c.preventDefault(),c.stopPropagation(),c.ctrlKey?g.toggleSelect(b):c.shiftKey?(g.selectRangeFromLast(b),c.preventDefault()):(g.clearSelection(),g.setSelected(b)),a.$apply()})},post:function(){}}}}}]),d.directive("nzSelectionManager",["$parse","$document","$timeout",function(d){return{require:"nzSelectionManager",controller:["$scope",function(a){var b;return b={scope:a,allSelectableElements:[],allSelectables:[],addSelectable:function(a,c){b.allSelectableElements.push(a),b.allSelectables.push(c)},isSelected:function(a){return b.isMultiSelect?b.getSelection().indexOf(a)>-1:b.getSelection()===a},setSelected:function(a){b.lastSelectedIndex=b.allSelectableElements.indexOf(a);var c=b.allSelectables[b.lastSelectedIndex],d=b.getSelection();b.isMultiSelect?d.push(c):d=c,b.updateSelectionModel(d)},toggleSelect:function(a){b.lastSelectedIndex=b.allSelectableElements.indexOf(a);var c=b.allSelectables[b.lastSelectedIndex],d=b.getSelection();if(b.isMultiSelect){var e=d.indexOf(c);-1===e?d.push(c):d.splice(e,1)}else{d===selectableObj&&(d=void 0)}b.updateSelectionModel(d)},selectRangeFromLast:function(a){if(b.isMultiSelect&&void 0!==b.lastSelectedIndex&&null!==b.lastSelectedIndex){var c=b.lastSelectedIndex,d=b.allSelectableElements.indexOf(a);b.clearSelection();var e=b.allSelectableElements.slice(Math.min(b.lastSelectedIndex,d),Math.max(b.lastSelectedIndex,d)+1);e.forEach(function(a){b.setSelected(a)}),b.lastSelectedIndex=c}else b.setSelected(a)},clearSelection:function(){b.getSelection().length=0}}}],compile:function(e,f){var g=this.name,h=f[g],i=d(h),j=a.isDefined(f.nzMultiSelect);return{pre:function(a,b,c,d){d.isMultiSelect=j,d.getSelection=function(){var b=i(a);return d.isMultiSelect&&!b&&(b=[]),b},d.updateSelectionModel=function(b){i.assign(a,b)}},post:function(a,d,e,f){f.isMultiSelect?a.$watchCollection(h,function(d,e){d||(d=[]),e||(e=[]);for(var f=e.length;f--;){var g=e[f];-1===d.indexOf(g)&&a.$broadcast(c,g)}for(var h=d.length;h--;){var i=d[h];-1===e.indexOf(i)&&a.$broadcast(b,i)}}):a.$watch(h,function(d,e){a.$broadcast(c,e),a.$broadcast(b,d)})}}}}}])}(angular);