!function(a){"use strict";var b=a.module("net.enzey.selection-manager.keyboard-navigation",[]);b.directive("nzSelectionKeyboardNavigation",["$parse",function(b){return{restrict:"A",require:["nzSelectionKeyboardNavigation","^nzSelectionManager"],controller:["$scope",function(){var a=this;return this.hasVerticalKeyboardNavigation=function(){return arguments[0]&&(a._hasVerticalKeyboardNavigation=!!arguments[0],a._hasHorizontalKeyboardNavigation=!a._hasVerticalKeyboardNavigation),!!a._hasVerticalKeyboardNavigation},this.hasHorizontalKeyboardNavigation=function(){return arguments[0]&&(a._hasHorizontalKeyboardNavigation=!!arguments[0],a._hasVerticalKeyboardNavigation=!a._hasHorizontalKeyboardNavigation),!!a._hasHorizontalKeyboardNavigation},a}],compile:function(c,d){return c.attr("tabindex")||c.attr("tabindex","-1"),{pre:function(c,e,f,g){var h=g[0],i=g[1];h.hasHorizontalKeyboardNavigation(!0),i._locationOfSoftSelection=a.isDefined(d.softSelectModel)?b(d.softSelectModel):null},post:function(a,b,c,d){var e=d[0],f=d[1],g=function(a){(13===a.keyCode||32===a.keyCode)&&(f.toggleSoftSelectAsSelected(),a.preventDefault(),a.stopPropagation())},h=function(b){if(38===b.keyCode){var c=f.getPreviousSelectableElement();f.setSoftSelection(c),b.preventDefault(),b.stopPropagation()}if(40===b.keyCode){var d=f.getNextSelectableElement();f.setSoftSelection(d),b.preventDefault(),b.stopPropagation()}g(b),a.$apply()},i=!1,j={};a.$watch(function(){return i&&(j.verticalNavigarion=e.hasVerticalKeyboardNavigation(),j.horizontalNavigarion=e.hasHorizontalKeyboardNavigation()),i=!0,j},function(a,c){a.horizontalNavigarion&&!c.horizontalNavigarion?(b[0].addEventListener("keydown",h),c.horizontalNavigarion=!0):!a.horizontalNavigarion&&c.horizontalNavigarion&&(b[0].removeEventListener("keydown",h),c.horizontalNavigarion=!1),a.verticalNavigarion&&!c.verticalNavigarion||!a.verticalNavigarion&&c.verticalNavigarion},!0)}}}}}])}(angular),function(a){"use strict";var b=a.module("net.enzey.selection-manager",["net.enzey.selection-manager.config","net.enzey.selection-manager.selection","net.enzey.selection-manager.keyboard-navigation"]);b.directive("nzSelectionManager",["$parse","$timeout","nzSelectionManagerEvents",function(b,c,d){return{restrict:"A",require:"nzSelectionManager",controller:["$scope","$timeout","$element","$attrs",function(c,e,f,g){var h=this,i=a.isDefined(g.nzMultiSelect),j=null,k=null,l=function(a){h._locationOfSelection?h._locationOfSelection.assign(c,a):h._selection=a},m=function(a){h._locationOfSoftSelection?h._locationOfSoftSelection.assign(c,a):h._softSelection=a};return this.scope=c,this._locationOfSelection=a.isDefined(g.ngModel)?b(g.ngModel):null,this._locationOfSoftSelection=null,this.getAllSelectables=function(){for(var a=[],b=f[0].querySelectorAll("*[nz-selectable], *[data-nz-selectable]"),c=0;c<b.length;c++)a.push(b[c]);return a},this.toggleSoftSelectAsSelected=function(){k&&f[0].contains(k)&&h.addSelected(k,!0)},this.getSelection=function(){var a=h._selection;return h._locationOfSelection&&(a=h._locationOfSelection(c)),i&&!a&&(a=[]),a},this.getSoftSelection=function(){var a=h._softSelection;return h._locationOfSoftSelection&&(a=h._locationOfSoftSelection(c)),a},this.setSoftSelection=function(b){k=b,b=a.element(b);var c=b.controller("nzSelectable");c&&(b[0].focus(),m(c.getSelectionObject()))},this.isSelected=function(a){return i?h.getSelection().indexOf(a)>-1:h.getSelection()===a},this.addSelected=function(b,c){var d=a.element(b),e=d.controller("nzSelectable");if(e){j=b;var f=h.getSelection(),g=e.getSelectionObject();if(i){var k=f.indexOf(g);-1===k?f.push(g):c&&f.splice(k,1)}else f!==g?f=g:c&&(f=void 0);l(f),h.setSoftSelection(j)}},this.rangeSelectFromLast=function(b){if(i&&f[0].contains(k)){var c=a.element(b),d=c.controller("nzSelectable");if(d&&k){var e=k;h.clearSelection();var g=h.getAllSelectables(),j=g.indexOf(b),l=g.indexOf(e),m=g.slice(Math.min(l,j),Math.max(l,j)+1);m.forEach(function(b){b=a.element(b),h.addSelected(b)}),k=e,h.setSoftSelection(k)}}else h.addSelected(b)},this.getNextSelectableElement=function(){var b=null,c=h.getAllSelectables();if(k&&f[0].contains(k)){var d=c.indexOf(k);d++,b=c[d],b||(b=c[0])}else{var e=c.map(function(b){var b=a.element(b),c=b.controller("nzSelectable");return c?c.getSelectionObject():void 0}),g=h.getSoftSelection(),i=e.indexOf(g);b=c[i],b||(b=c[0])}return b},this.getPreviousSelectableElement=function(){var b=null,c=h.getAllSelectables();if(k&&f[0].contains(k)){var d=c.indexOf(k);d--,b=c[d],b||(b=c[c.length-1])}else{var e=c.map(function(b){var b=a.element(b),c=b.controller("nzSelectable");return c?c.getSelectionObject():void 0}),g=h.getSoftSelection(),i=e.indexOf(g);b=c[i],b||(b=c[c.length-1])}return b},this.clearSelection=function(){var b=h.getSelection();a.isArray(b)?h.getSelection().length=0:l(null)},i?c.$watchCollection(h.getSelection,function(a,b){a||(a=[]),b||(b=[]);for(var e=b.length;e--;){var f=b[e];-1===a.indexOf(f)&&c.$broadcast(d.getDeselectEvent(),f)}for(var g=a.length;g--;){var h=a[g];-1===b.indexOf(h)&&c.$broadcast(d.getSelectEvent(),h)}}):c.$watch(h.getSelection,function(a,b){c.$broadcast(d.getDeselectEvent(),b),c.$broadcast(d.getSelectEvent(),a)}),c.$watch(h.getSoftSelection,function(a,b){c.$broadcast(d.getSoftDeselectEvent(),b),c.$broadcast(d.getSoftSelectEvent(),a)}),h}],compile:function(){this.name;return{pre:function(){},post:function(){}}}}}])}(angular),function(a){"use strict";var b=a.module("net.enzey.selection-manager.config",[]);b.provider("nzSelectionManagerConfig",function(){var a=null,b=null;this.setSelectionClass=function(b){a=b},this.setSoftSelectionClass=function(a){b=a},this.$get=function(){return{getSelectionClass:function(){return a},getSoftSelectionClass:function(){return b}}}})}(angular),function(a){"use strict";var b=a.module("net.enzey.selection-manager.events",[]);b.service("nzSelectionManagerEvents",function(){this.getSelectEvent=function(){return"nzSelect"},this.getDeselectEvent=function(){return"nzDeselect"},this.getSoftSelectEvent=function(){return"nzSoftSelect"},this.getSoftDeselectEvent=function(){return"nzSoftDeselect"}})}(angular),function(a){"use strict";var b=a.module("net.enzey.selection-manager.selection",["net.enzey.selection-manager.events"]);b.service("nzSelectionClassApplier",["nzSelectionManagerConfig","nzSelectionManagerEvents",function(a,b){return{applySoftSelectionClass:function(b,c,d,e){e||(e=a.getSoftSelectionClass()),b.getSoftSelection()===d?c.addClass(e):c.removeClass(e)},applySelectionClass:function(b,c,d,e){e||(e=a.getSelectionClass()),b.isSelected(d)?c.addClass(e):c.removeClass(e)},addSoftSelectionEvents:function(c,d,e,f){f||(f=a.getSoftSelectionClass()),c.$on(b.getSoftSelectEvent(),function(a,b){b===e&&d.addClass(f)}),c.$on(b.getSoftDeselectEvent(),function(a,b){b===e&&d.removeClass(f)})},addSelectionEvents:function(c,d,e,f){f||(f=a.getSelectionClass()),c.$on(b.getSelectEvent(),function(a,b){b===e&&d.addClass(f)}),c.$on(b.getDeselectEvent(),function(a,b){b===e&&d.removeClass(f)})}}}]),b.directive("nzSelectionClass",["nzSelectionClassApplier",function(a){return{restrict:"A",controller:["$scope",function(){return{}}],require:["nzSelectionClass","^nzSelectionManager"],compile:function(b,c){var d=this.name;return{pre:function(a,b,c,d){d[0],d[1]},post:function(b,e,f,g){var h=g[0],i=g[1],j=h.selectionObj;a.applySelectionClass(i,e,j,c[d]),a.addSelectionEvents(b,e,j,c[d])}}}}}]),b.directive("nzSoftSelectionClass",["nzSelectionClassApplier",function(a){return{restrict:"A",controller:["$scope",function(){return{}}],require:["nzSoftSelectionClass","^nzSelectionManager"],compile:function(b,c){var d=this.name;return{pre:function(a,b,c,d){d[0],d[1]},post:function(b,e,f,g){var h=g[0],i=g[1],j=h.selectionObj;a.applySoftSelectionClass(i,e,j,c[d]),a.addSoftSelectionEvents(b,e,j,c[d])}}}}}]),b.directive("nzSelectable",["$parse","nzSelectionClassApplier",function(a,b){return{restrict:"A",controller:["$scope",function(){var a=this;return this.getSelectionObject=function(){return a.selectionObj},this}],require:["?^nzSelectionClass","?^nzSoftSelectionClass","^nzSelectionManager","nzSelectable"],compile:function(c,d){var e=this.name,f=a(d[e]);return{pre:function(a,c,d,e){var g=e[0],h=e[1],i=e[2],j=e[3],k=f(a);j.selectionObj=k,g?g.selectionObj=k:(b.applySelectionClass(i,c,k),b.addSelectionEvents(a,c,k)),h?h.selectionObj=k:(b.applySoftSelectionClass(i,c,k),b.addSoftSelectionEvents(a,c,k)),c.on("click",function(b){b.preventDefault(),b.ctrlKey?i.addSelected(c[0],!0):b.shiftKey?(i.rangeSelectFromLast(c[0]),b.preventDefault()):(i.clearSelection(),i.addSelected(c[0],!1)),a.$apply()})},post:function(){}}}}}])}(angular);