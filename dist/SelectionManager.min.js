!function(a){"use strict";var b=a.module("net.enzey.selection-manager.keyboard-navigation",[]);b.directive("nzSelectionKeyboardNavigation",["$parse",function(b){return{restrict:"A",require:["nzSelectionKeyboardNavigation","^nzSelectionManager"],controller:["$scope",function(a){var b=this;return this.hasVerticalKeyboardNavigation=function(){return arguments[0]&&(b._hasVerticalKeyboardNavigation=!!arguments[0],b._hasHorizontalKeyboardNavigation=!b._hasVerticalKeyboardNavigation),!!b._hasVerticalKeyboardNavigation},this.hasHorizontalKeyboardNavigation=function(){return arguments[0]&&(b._hasHorizontalKeyboardNavigation=!!arguments[0],b._hasVerticalKeyboardNavigation=!b._hasHorizontalKeyboardNavigation),!!b._hasHorizontalKeyboardNavigation},b}],compile:function(c,d){return c.attr("tabindex")||c.attr("tabindex","-1"),{pre:function(c,e,f,g){var h=g[0],i=g[1];h.hasHorizontalKeyboardNavigation(!0),i._locationOfSoftSelection=a.isDefined(d.softSelectModel)?b(d.softSelectModel):null},post:function(a,b,c,d){var e=d[0],f=d[1],g=function(a){(13===a.keyCode||32===a.keyCode)&&(f.toggleSoftSelectAsSelected(),a.preventDefault(),a.stopPropagation())},h=function(b){if(38===b.keyCode){var c=f.getPreviousSelectableElement();f.setSoftSelection(c),b.preventDefault(),b.stopPropagation()}if(40===b.keyCode){var d=f.getNextSelectableElement();f.setSoftSelection(d),b.preventDefault(),b.stopPropagation()}g(b),a.$apply()},i=!1,j={};a.$watch(function(){return i&&(j.verticalNavigarion=e.hasVerticalKeyboardNavigation(),j.horizontalNavigarion=e.hasHorizontalKeyboardNavigation()),i=!0,j},function(a,c){a.horizontalNavigarion&&!c.horizontalNavigarion?(b[0].addEventListener("keydown",h),c.horizontalNavigarion=!0):!a.horizontalNavigarion&&c.horizontalNavigarion&&(b[0].removeEventListener("keydown",h),c.horizontalNavigarion=!1),a.verticalNavigarion&&!c.verticalNavigarion||!a.verticalNavigarion&&c.verticalNavigarion},!0)}}}}}])}(angular),function(a){"use strict";var b=a.module("net.enzey.selection-manager",["net.enzey.selection-manager.config","net.enzey.selection-manager.selection","net.enzey.selection-manager.keyboard-navigation"]);b.directive("nzSelectionManager",["$parse","$document","$timeout","nzSelectionManagerEvents",function(b,c,d,e){return{restrict:"A",require:"nzSelectionManager",controller:["$scope","$timeout","$element","$attrs",function(d,f,g,h){var i=this,j=a.isDefined(h.nzMultiSelect),k=null,l=null,m=function(a){i._locationOfSelection?i._locationOfSelection.assign(d,a):i._selection=a},n=function(a){i._locationOfSoftSelection?i._locationOfSoftSelection.assign(d,a):i._softSelection=a};return this.scope=d,this._locationOfSelection=a.isDefined(h.ngModel)?b(h.ngModel):null,this._locationOfSoftSelection=null,this.getAllSelectables=function(){for(var a=[],b=g[0].querySelectorAll("*[nz-selectable], *[data-nz-selectable]"),c=0;c<b.length;c++)a.push(b[c]);return a},this.toggleSoftSelectAsSelected=function(){l&&c[0].contains(l)&&i.addSelected(l,!0)},this.getSelection=function(){var a=i._selection;return i._locationOfSelection&&(a=i._locationOfSelection(d)),j&&!a&&(a=[]),a},this.getSoftSelection=function(){var a=i._softSelection;return i._locationOfSoftSelection&&(a=i._locationOfSoftSelection(d)),a},this.setSoftSelection=function(b){l=b,b=a.element(b);var c=b.controller("nzSelectable");c&&(b[0].focus(),n(c.getSelectionObject()))},this.isSelected=function(a){return j?i.getSelection().indexOf(a)>-1:i.getSelection()===a},this.addSelected=function(b,c){var d=a.element(b),e=d.controller("nzSelectable");if(e){k=b;var f=i.getSelection(),g=e.getSelectionObject();if(j){var h=f.indexOf(g);-1===h?f.push(g):c&&f.splice(h,1)}else f!==g?f=g:c&&(f=void 0);m(f),i.setSoftSelection(k)}},this.rangeSelectFromLast=function(b){if(j&&c[0].contains(l)){var d=a.element(b),e=d.controller("nzSelectable");if(e&&l){var f=l;i.clearSelection();var g=i.getAllSelectables(),h=g.indexOf(b),k=g.indexOf(f),m=g.slice(Math.min(k,h),Math.max(k,h)+1);m.forEach(function(b){b=a.element(b),i.addSelected(b)}),l=f,i.setSoftSelection(l)}}else i.addSelected(b)},this.getNextSelectableElement=function(){var b=null,d=i.getAllSelectables();if(l&&c[0].contains(l)){var e=d.indexOf(l);e++,b=d[e],b||(b=d[0])}else{var f=d.map(function(b){var b=a.element(b),c=b.controller("nzSelectable");return c?c.getSelectionObject():void 0}),g=i.getSoftSelection(),h=f.indexOf(g);b=d[h],b||(b=d[0])}return b},this.getPreviousSelectableElement=function(){var b=null,d=i.getAllSelectables();if(l&&c[0].contains(l)){var e=d.indexOf(l);e--,b=d[e],b||(b=d[d.length-1])}else{var f=d.map(function(b){var b=a.element(b),c=b.controller("nzSelectable");return c?c.getSelectionObject():void 0}),g=i.getSoftSelection(),h=f.indexOf(g);b=d[h],b||(b=d[d.length-1])}return b},this.clearSelection=function(){var b=i.getSelection();a.isArray(b)?i.getSelection().length=0:m(null)},j?d.$watchCollection(i.getSelection,function(a,b){a||(a=[]),b||(b=[]);for(var c=b.length;c--;){var f=b[c];-1===a.indexOf(f)&&d.$broadcast(e.getDeselectEvent(),f)}for(var g=a.length;g--;){var h=a[g];-1===b.indexOf(h)&&d.$broadcast(e.getSelectEvent(),h)}}):d.$watch(i.getSelection,function(a,b){d.$broadcast(e.getDeselectEvent(),b),d.$broadcast(e.getSelectEvent(),a)}),d.$watch(i.getSoftSelection,function(a,b){d.$broadcast(e.getSoftDeselectEvent(),b),d.$broadcast(e.getSoftSelectEvent(),a)}),i}],compile:function(a,b){this.name;return{pre:function(a,b,c,d){},post:function(a,b,c,d){}}}}}])}(angular),function(a){"use strict";var b=a.module("net.enzey.selection-manager.config",[]);b.provider("nzSelectionManagerConfig",function(){var a=null,b=null;this.setSelectionClass=function(b){a=b},this.setSoftSelectionClass=function(a){b=a},this.$get=function(){return{getSelectionClass:function(){return a},getSoftSelectionClass:function(){return b}}}})}(angular),function(a){"use strict";var b=a.module("net.enzey.selection-manager.events",[]);b.service("nzSelectionManagerEvents",function(){this.getSelectEvent=function(){return"nzSelect"},this.getDeselectEvent=function(){return"nzDeselect"},this.getSoftSelectEvent=function(){return"nzSoftSelect"},this.getSoftDeselectEvent=function(){return"nzSoftDeselect"}})}(angular),function(a){"use strict";var b=a.module("net.enzey.selection-manager.selection",["net.enzey.selection-manager.events"]);b.service("nzSelectionClassApplier",["nzSelectionManagerConfig","nzSelectionManagerEvents",function(a,b){return{applySoftSelectionClass:function(b,c,d,e){e||(e=a.getSoftSelectionClass()),b.getSoftSelection()===d?c.addClass(e):c.removeClass(e)},applySelectionClass:function(b,c,d,e){e||(e=a.getSelectionClass()),b.isSelected(d)?c.addClass(e):c.removeClass(e)},addSoftSelectionEvents:function(c,d,e,f){f||(f=a.getSoftSelectionClass()),c.$on(b.getSoftSelectEvent(),function(a,b){b===e&&d.addClass(f)}),c.$on(b.getSoftDeselectEvent(),function(a,b){b===e&&d.removeClass(f)})},addSelectionEvents:function(c,d,e,f){f||(f=a.getSelectionClass()),c.$on(b.getSelectEvent(),function(a,b){b===e&&d.addClass(f)}),c.$on(b.getDeselectEvent(),function(a,b){b===e&&d.removeClass(f)})}}}]),b.directive("nzSelectionClass",["nzSelectionClassApplier",function(a){return{restrict:"A",controller:["$scope",function(a){return{}}],require:["nzSelectionClass","^nzSelectionManager"],compile:function(b,c){var d=this.name;return{pre:function(a,b,c,d){d[0],d[1]},post:function(b,e,f,g){var h=g[0],i=g[1],j=h.selectionObj;a.applySelectionClass(i,e,j,c[d]),a.addSelectionEvents(b,e,j,c[d])}}}}}]),b.directive("nzSoftSelectionClass",["nzSelectionClassApplier",function(a){return{restrict:"A",controller:["$scope",function(a){return{}}],require:["nzSoftSelectionClass","^nzSelectionManager"],compile:function(b,c){var d=this.name;return{pre:function(a,b,c,d){d[0],d[1]},post:function(b,e,f,g){var h=g[0],i=g[1],j=h.selectionObj;a.applySoftSelectionClass(i,e,j,c[d]),a.addSoftSelectionEvents(b,e,j,c[d])}}}}}]),b.directive("nzSelectable",["$parse","nzSelectionClassApplier",function(a,b){return{restrict:"A",controller:["$scope",function(a){var b=this;return this.getSelectionObject=function(){return b.selectionObj},this}],require:["?^nzSelectionClass","?^nzSoftSelectionClass","^nzSelectionManager","nzSelectable"],compile:function(c,d){var e=this.name,f=a(d[e]);return{pre:function(a,c,d,e){var g=e[0],h=e[1],i=e[2],j=e[3],k=f(a);j.selectionObj=k,g?g.selectionObj=k:(b.applySelectionClass(i,c,k),b.addSelectionEvents(a,c,k)),h?h.selectionObj=k:(b.applySoftSelectionClass(i,c,k),b.addSoftSelectionEvents(a,c,k)),c.on("click",function(b){b.preventDefault(),b.ctrlKey?i.addSelected(c[0],!0):b.shiftKey?(i.rangeSelectFromLast(c[0]),b.preventDefault()):(i.clearSelection(),i.addSelected(c[0],!1)),a.$apply()})},post:function(a,b,c){}}}}}])}(angular);