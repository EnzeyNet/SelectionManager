!function(a){"use strict";var b="nzSelect",c="nzDeselect",d="nzSoftSelect",e="nzSoftDeselect",f=a.module("net.enzey.selection-manager",[]);f.provider("nzSelectionManagerConfig",function(){var a=null;this.setSelectionClass=function(b){a=b},this.$get=function(){return{getSelectionClass:function(){return a}}}}),f.directive("nzSelectionClass",["nzSelectionManagerConfig",function(a){return{restrict:"A",controller:["$scope",function(){return{}}],require:["nzSelectionClass","^nzSelectionManager"],compile:function(d,e){var f=this.name;return{pre:function(a,b,c,d){d[0],d[1]},post:function(d,g,h,i){var j=i[0],k=i[1],l=e[f];l||(l=a.getSelectionClass());var m=j.selectionObj,n=function(){k.isSelected(m)?g.addClass(l):g.removeClass(l)};n(),d.$on(b,function(a,b){b===m&&g.addClass(l)}),d.$on(c,function(a,b){b===m&&g.removeClass(l)})}}}}}]),f.directive("nzSoftSelectionClass",["nzSelectionManagerConfig",function(a){return{restrict:"A",controller:["$scope",function(){return{}}],require:["nzSoftSelectionClass","^nzSelectionManager"],compile:function(b,c){var f=this.name;return{pre:function(a,b,c,d){d[0],d[1]},post:function(b,g,h,i){var j=i[0],k=i[1],l=c[f];l||(l=a.getSoftSelectionClass());var m=j.selectionObj,n=function(){k.isSelected(m)?g.addClass(l):g.removeClass(l)};n(),b.$on(d,function(a,b){b===m&&g.addClass(l)}),b.$on(e,function(a,b){b===m&&g.removeClass(l)})}}}}}]),f.directive("nzSelectable",["$parse",function(a){return{restrict:"A",require:["?^nzSelectionClass","?^nzSoftSelectionClass","^nzSelectionManager"],compile:function(b,c){var d=this.name,e=a(c[d]);return{pre:function(a,b,c,d){var f=d[0],g=d[1],h=d[2],i=e(a);f&&(f.selectionObj=i),g&&(g.selectionObj=i),h.addSelectable(b[0],i),b.on("click",function(c){c.preventDefault(),c.stopPropagation(),c.ctrlKey?(h.toggleSelected(b[0]),h.setSoftSelection(b[0])):c.shiftKey?(h.selectRangeFromLast(b[0]),h.setSoftSelection(b[0]),c.preventDefault()):(h.clearSelection(),h.addSelected(b[0]),h.setSoftSelection(b[0])),a.$apply()})},post:function(){}}}}}]),f.directive("nzSelectionManager",["$parse","$document","$timeout",function(f){return{restrict:"A",require:"nzSelectionManager",controller:["$scope","$timeout",function(f,g){var h,i=function(a){h._locationOfSelection?h._locationOfSelection.assign(f,a):h._selection=a},j=function(a){h._locationOfSoftSelection?h._locationOfSoftSelection.assign(f,a):h._softSelection=a};return h={scope:f,allSelectableElements:[],allSelectables:[],_locationOfSelection:null,_locationOfSoftSelection:null,getElementFromObj:function(a){var b=h.allSelectables.indexOf(a);return h.allSelectableElements[b]},getSelection:function(){var a=h._selection;return h._locationOfSelection&&(a=h._locationOfSelection(f)),h.isMultiSelect&&!a&&(a=[]),a},getSoftSelection:function(){var a=h._softSelection;return h._locationOfSoftSelection&&(a=h._locationOfSoftSelection(f)),a},setSoftSelection:function(a){var b=h.allSelectableElements.indexOf(a),c=h.allSelectables[b];j(c)},addSelectable:function(a,b){h.allSelectableElements.push(a),h.allSelectables.push(b)},isSelected:function(a){return h.isMultiSelect?h.getSelection().indexOf(a)>-1:h.getSelection()===a},addSelected:function(a){h.lastSelectedElement=a;var b=h.allSelectableElements.indexOf(a),c=h.allSelectables[b],d=h.getSelection();h.isMultiSelect?-1===d.indexOf(c)&&d.push(c):d=c,i(d)},toggleSelected:function(a){h.lastSelectedElement=a;var b=h.allSelectableElements.indexOf(a),c=h.allSelectables[b],d=h.getSelection();if(h.isMultiSelect){var e=d.indexOf(c);-1===e?d.push(c):d.splice(e,1)}else d=d===c?void 0:c;i(d)},selectRangeFromLast:function(a){if(h.isMultiSelect&&void 0!==h.lastSelectedElement&&null!==h.lastSelectedElement){var b=h.lastSelectedElement,c=h.allSelectableElements.indexOf(b),d=h.allSelectableElements.indexOf(a);h.clearSelection();var e=h.allSelectableElements.slice(Math.min(c,d),Math.max(c,d)+1);e.forEach(function(a){h.addSelected(a)}),h.lastSelectedElement=b}else h.addSelected(a)},getNextSelectableElement:function(a){var b=h.allSelectableElements.indexOf(a);return b++,b>=h.allSelectableElements.length&&(b=0),h.allSelectableElements[b]},getPreviousSelectableElement:function(a){var b=h.allSelectableElements.indexOf(a);return b--,0>b&&(b=h.allSelectableElements.length-1),h.allSelectableElements[b]},clearSelection:function(){var b=h.getSelection();a.isArray(b)?h.getSelection().length=0:i(null)}},g(function(){h.isMultiSelect?f.$watchCollection(h.getSelection,function(a,d){a||(a=[]),d||(d=[]);for(var e=d.length;e--;){var g=d[e];-1===a.indexOf(g)&&f.$broadcast(c,g)}for(var h=a.length;h--;){var i=a[h];-1===d.indexOf(i)&&f.$broadcast(b,i)}}):f.$watch(h.getSelection,function(a,d){f.$broadcast(c,d),f.$broadcast(b,a)}),f.$watch(h.getSoftSelection,function(a,b){f.$broadcast(e,b),f.$broadcast(d,a)})}),h}],compile:function(b,c){var d=this.name,e=c[d],g=f(e),h=a.isDefined(c.nzMultiSelect);return{pre:function(a,b,c,d){d.isMultiSelect=h,d._locationOfSelection=g},post:function(){}}}}}]),f.directive("nzSelectionKeyboardNavigation",["$timeout",function(){return{restrict:"A",require:["nzSelectionKeyboardNavigation","^nzSelectionManager"],controller:["$scope",function(){var a;return a={hasVerticalKeyboardNavigation:function(){return arguments[0]&&(a._hasVerticalKeyboardNavigation=!!arguments[0],a._hasHorizontalKeyboardNavigation=!a._hasVerticalKeyboardNavigation),!!a._hasVerticalKeyboardNavigation},hasHorizontalKeyboardNavigation:function(){return arguments[0]&&(a._hasHorizontalKeyboardNavigation=!!arguments[0],a._hasVerticalKeyboardNavigation=!a._hasHorizontalKeyboardNavigation),!!a._hasHorizontalKeyboardNavigation}}}],compile:function(a){return a.attr("tabindex")||a.attr("tabindex","-1"),{pre:function(a,b,c,d){{var e=d[0];d[1]}e.hasHorizontalKeyboardNavigation(!0)},post:function(a,b,c,d){var e=d[0],f=d[1],g=function(a){if(13===a.keyCode||32===a.keyCode){f.clearSelection();var b=f.getSoftSelection(),c=f.getElementFromObj(b);f.addSelected(c),a.preventDefault(),a.stopPropagation()}},h=function(b){if(38===b.keyCode){var c=f.getSoftSelection(),d=f.getElementFromObj(c),e=f.getPreviousSelectableElement(d);f.setSoftSelection(e),b.preventDefault(),b.stopPropagation()}if(40===b.keyCode){var c=f.getSoftSelection(),d=f.getElementFromObj(c),h=f.getNextSelectableElement(d);f.setSoftSelection(h),b.preventDefault(),b.stopPropagation()}g(b),a.$apply()},i=!1,j={};a.$watch(function(){return i&&(j.verticalNavigarion=e.hasVerticalKeyboardNavigation(),j.horizontalNavigarion=e.hasHorizontalKeyboardNavigation()),i=!0,j},function(a,c){a.horizontalNavigarion&&!c.horizontalNavigarion?(b.on("keydown",h),c.horizontalNavigarion=!0):!a.horizontalNavigarion&&c.horizontalNavigarion&&(b.off("keydown",h),c.horizontalNavigarion=!1),a.verticalNavigarion&&!c.verticalNavigarion||!a.verticalNavigarion&&c.verticalNavigarion},!0)}}}}}])}(angular);